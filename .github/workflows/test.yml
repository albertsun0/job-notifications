name: Test
run-name: Sraping Jobs ðŸš€
on:
  [push]

  # schedule:
  #     - cron:  '0 10 * * *'
jobs:
  ScrapeJobs:
    runs-on: ubuntu-latest
    outputs:
      SCRAPER_OUTPUTS: ${{ steps.runScraper.outputs.SCRAPER_OUTPUTS }}
    steps:
      - run: echo "ðŸŽ‰ The job was automatically triggered by a event."

      - name: checkout repo
        uses: actions/checkout@v2

      - name: setup python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: install requirements
        run: pip install -r requirements.txt

      - id: runScraper
        run: python scrape.py

  create-issue-1:
    permissions:
      issues: write
      pull-requests: write
    runs-on: ubuntu-latest
    needs: ScrapeJobs
    steps:
      - env:
          SCRAPER_OUTPUTS: ${{needs.ScrapeJobs.outputs.SCRAPER_OUTPUTS}}
        run: echo "$SCRAPER_OUTPUTS"

      - name: Get Current Time as ENV
        run: echo "NOW=$(date +'%Y-%m-%dT%H:%M:%S')" >> $GITHUB_ENV

      - env:
          SCRAPER_OUTPUTS: ${{needs.ScrapeJobs.outputs.SCRAPER_OUTPUTS}}
        name: Create Issue With Results
        uses: dacbd/create-issue-action@main
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: New Jobs Scraped - ${{ env.NOW }}

          # Auto-assign person who triggered the failure.
          labels: scrape
          body: "$SCRAPER_OUTPUTS"
